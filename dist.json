{"index.html":"<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css\">\n    </head>\n    <body>\n        <section class=\"section\">\n            <div v-scope>\n                <div class=\"container\">\n                  <div class=\"box\" v-if=\"waddr\">\n                      <div v-if=\"chainId=='0x1336'\">\n                          <label class=\"label\">Address</label>\n                          <div class=\"control\">\n                              <input class=\"input\" type=\"text\" disabled v-model=\"waddr\">\n                          </div>\n                          <label v-if=\"balance\" class=\"label\">Balance</label>\n                          <div v-if=\"balance\" class=\"control\">\n                              <input class=\"input\" type=\"text\" disabled v-model=\"balance\">\n                          </div>\n                          <div class=\"control\">\n                              <button class=\"button is-primary\" @click=\"airdrop\">Airdrop</button>\n                          </div>\n                          <div v-if=\"high_balance\" class=\"control\">\n                              <label class=\"label\">Faucet Balance:<span>{{fbalance}}</span></label>\n                              <button class=\"button\" @click=\"donate\">Donate 10 Test Coin</button>\n                          </div>\n                      </div>\n                      <div v-else>\n                          <div class=\"notification is-primary\">\n                              <p>Wrong network</p>\n                              <button @click=\"switchNet\" class=\"button is-warning\">Switch to Venidium Testnet</button>\n                          </div>\n                      </div>\n                  </div>\n                  <button v-else @click=\"connect\" class=\"button is-primary\">Connect Wallet</button>\n                </div>\n            </div>\n        </section>\n        <script src=\"https://unpkg.com/petite-vue\"></script>\n        <script src='https://cdn.jsdelivr.net/npm/bignumber.js@9.0.2/bignumber.min.js'></script>\n        <script src=\"//cdn.jsdelivr.net/npm/sweetalert2@11\"></script>\n        <script src=\"https://cdn.ethers.io/lib/ethers-5.0.umd.min.js\" type=\"text/javascript\"></script>\n        <script>\n          const ethereum = window.ethereum\n          const CHAIN_ID='0x1336'\n          PetiteVue.createApp({\n            waddr: false,\n            high_balance: false,\n            balance: false,\n            chainId: false,\n            initialized: false,\n            dropFrom:'<%= addr %>',\n            fbalance: false,\n            async connect(){\n                if (typeof ethereum !== 'undefined') {\n                    await this.initialize()\n                    if(await this.ensureNet()){\n                        this.chainId = await ethereum.request({ method:'eth_chainId' })\n                        const user = await ethereum.request({ method:'eth_requestAccounts' })\n                        if(user&&user[0]){\n                            this.waddr = user[0]\n                        }\n                        await this.loadBalance()\n                    }\n                    console.log('connect done')\n                }\n            },\n            async initialize(){\n                if(!this.initialized){\n                    this.initialized = true\n                    const root = this\n                    ethereum.on('connect', async (cinfo)=>{\n                        if(!root.chainId){\n                            root.chainId = cinfo.chainId\n                        }\n                        if(!root.waddr){\n                            const user = await ethereum.request({ method:'eth_requestAccounts' })\n                            if(user&&user[0]){\n                                root.waddr = user[0]\n                            }\n                        }\n                    })\n                    ethereum.on('disconnect', ()=>{\n                        console.log('disconnected')\n                        root.waddr = false\n                        root.chainId = false\n                    })\n \n                    ethereum.on('accountsChanged', (accounts)=>{\n                       if(accounts.length>0){\n                           root.waddr = accounts[0]\n                       }else{\n                           root.waddr = false\n                       }\n                       this.loadBalance()\n                    })\n                    ethereum.on('chainChanged', async (chainId)=>{\n                        if(chainId!=root.chainId){\n                            root.chainId = chainId\n                        }\n                        await this.loadBalance()\n                    })\n                }\n            },\n            async loadBalance(){\n                this.high_balance = false\n                if(this.chainId==CHAIN_ID){\n                    if(this.waddr){\n                        const balance = await ethereum.request({ method: 'eth_getBalance', params: [this.waddr, 'latest'] })\n                        const bn = (new BigNumber(balance)).dividedBy(1e18)\n                        this.balance = bn.toNumber()\n                        if(bn>=20){\n                            this.high_balance = true\n                        }\n                        console.log('balance', this.balance)\n                    }else{\n                        this.balance = false\n                    }\n                    if(this.dropFrom){\n                        const balance = await ethereum.request({ method: 'eth_getBalance', params: [this.waddr, 'latest'] })\n                        const bn = (new BigNumber(balance)).dividedBy(1e18)\n                        this.fbalance = bn.toNumber()\n                    }\n                }\n            },\n            async addNet(){\n                try {\n                    const res = await ethereum.request({\n                        method: 'wallet_addEthereumChain',\n                        params:[{\n                            chainId: CHAIN_ID,\n                            chainName: 'Venidium EVM Testnet',\n                            rpcUrls: [\n                                \"https://rpc-evm-testnet.venidium.io\"\n                            ],\n                            nativeCurrency:{\n                                name: \"Venidium\",\n                                symbol: \"XVM\",\n                                decimals: 18\n                            },\n                            blockExplorerUrls:[\n                                \"https://evm-testnet.venidiumexplorer.com\"\n                            ]\n                        }]\n                    })\n                }catch(e){\n                    return false\n                }\n                return true\n            },\n            async switchNet(){\n                try {\n                    const res = await ethereum.request({method: 'wallet_switchEthereumChain', \n                        params:[{chainId:CHAIN_ID}]})\n                }catch(e){\n                    if('code' in e && e.code==4902){\n                        if(await this.addNet()){\n                            await this.switchNet()\n                        }\n                    }else{\n                        console.log('error', e)\n                    }\n                }\n            },\n            async ensureNet(){\n                let chainId = await ethereum.request({ method:'eth_chainId' })\n                if(chainId!=CHAIN_ID){\n                    await this.switchNet()\n                    chainId = await ethereum.request({ method:'eth_chainId' })\n                }\n                if(chainId==CHAIN_ID){\n                    return true\n                }else{\n                    return false\n                }\n            },\n            async airdrop(){\n                let xhr = new XMLHttpRequest();\n                xhr.open(\"POST\", \"/airdrop\");\n                xhr.setRequestHeader(\"Accept\", \"application/json\");\n                xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n                xhr.onload = () => {\n                    const res = JSON.parse(xhr.responseText)\n                    if(res.success){\n                        Swal.fire({\n                            title: 'Done',\n                            text: '0.01 XVM has been sent to your wallet'\n                        })\n                    }else{\n                        switch(res.reason){\n                            case 'balance':\n                                Swal.fire({\n                                    title: 'Failed',\n                                    text: 'You already have more than 0.01 XVM'\n                                })\n                                break\n                            default:\n                                alert(res.reason)\n                        }\n                    }\n                    console.log(xhr.responseText);\n                }\n                const data = {\n                    addr: this.waddr,\n                    chain: this.chainId\n                }\n                xhr.send(JSON.stringify(data));\n            },\n            async donate(){\n                const amount = (new BigNumber(1e18)).multipliedBy(10)\n                const txargs = {\n                    to: this.dropFrom,\n                    from: this.waddr,\n                    value: amount.toString(16)\n                }\n                const txid = await ethereum.request({\n                    method: 'eth_sendTransaction',\n                    params: [txargs]\n                })\n                if(txid){\n                    alert('ok')\n                }\n            }\n          }).mount()\n          function connected(info){\n              console.log('connect info', info)\n          }\n          ethereum.on('connect', connected)\n        </script>\n    </body>\n</html>\n","/":""}